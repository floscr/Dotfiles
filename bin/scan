#!/usr/bin/env cached-nix-shell
#! nix-shell -i bash -p libtiff scantailor libtiff pdftk tesseract

DEBUG=
FILENAME="$1"
TMPDIR=$(mktemp --suffix scan2pdf --directory)
cd "$TMPDIR"

[[ $DEBUG ]] && echo "Scanning..."

scanimage \
    --mode Color \
    --resolution 600 \
    --format pnm \
    > out.pnm

[[ $DEBUG ]] && echo "Processing..."

scantailor-cli \
    --color-mode=black_and_white \
    --despeckle=normal \
    out.pnm \
    ./

tesseract -l deu -psm 1 "out.pnm" out

[[ $DEBUG ]] && echo "Copying..."

cd -
echo "$TMPDIR"
